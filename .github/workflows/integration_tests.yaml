name: integration tests
on: [push]
env:
  BITCOIN_VERSION: '22.0'
  LSP_REF: 'breez-node-v0.16.2-beta'
  CLIENT_REF: 'v0.16.2-breez'
  GO_VERSION: '^1.19'
  CLN_VERSION: 'v23.05.1'
jobs:

  setup-bitcoin-core:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Bitcoin Core
        if: steps.cache-bitcoin.outputs.cache-hit != 'true'
        uses: ./.github/actions/setup-bitcoin
        with:
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
  
  setup-lnd-lsp:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up LND LSP
        if: steps.cache-lnd-lsp.outputs.cache-hit != 'true'
        uses: ./.github/actions/setup-lnd-lsp
        with:
          lsp-ref: ${{ env.LSP_REF }}
          go-version: ${{ env.GO_VERSION }}

  setup-lnd-client:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up LND client
        if: steps.cache-lnd-client.outputs.cache-hit != 'true'
        uses: ./.github/actions/setup-lnd-client
        with:
          client-ref: ${{ env.CLIENT_REF }}
          go-version: ${{ env.GO_VERSION }}

  setup-cln:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Core Lightning
        uses: ./.github/actions/setup-clightning
        with:
          checkout-version: ${{ env.CLN_VERSION }}

  build-lspd:
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Build LSPD and Upload Artifacts
        uses: ./.github/actions/build-lspd


  TestLspd-LND-lspd_testOpenZeroConfChannelOnReceive:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testOpenZeroConfChannelOnReceive"
          artifact-name: TestLspd-LND-lspd_testOpenZeroConfChannelOnReceive
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testOpenZeroConfSingleHtlc:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testOpenZeroConfSingleHtlc"
          artifact-name: TestLspd-LND-lspd_testOpenZeroConfSingleHtlc
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testZeroReserve:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testZeroReserve"
          artifact-name: TestLspd-LND-lspd_testZeroReserve
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testFailureBobOffline:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testFailureBobOffline"
          artifact-name: TestLspd-LND-lspd_testFailureBobOffline
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testNoBalance:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testNoBalance"
          artifact-name: TestLspd-LND-lspd_testNoBalance
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testRegularForward:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testRegularForward"
          artifact-name: TestLspd-LND-lspd_testRegularForward
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testProbing:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testProbing"
          artifact-name: TestLspd-LND-lspd_testProbing
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testInvalidCltv:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testInvalidCltv"
          artifact-name: TestLspd-LND-lspd_testInvalidCltv
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_registerPaymentWithTag:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_registerPaymentWithTag"
          artifact-name: TestLspd-LND-lspd_registerPaymentWithTag
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testOpenZeroConfUtxo:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testOpenZeroConfUtxo"
          artifact-name: TestLspd-LND-lspd_testOpenZeroConfUtxo
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testDynamicFeeFlow:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testDynamicFeeFlow"
          artifact-name: TestLspd-LND-lspd_testDynamicFeeFlow
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testOfflineNotificationPaymentRegistered:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testOfflineNotificationPaymentRegistered"
          artifact-name: TestLspd-LND-lspd_testOfflineNotificationPaymentRegistered
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testOfflineNotificationRegularForward:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testOfflineNotificationRegularForward"
          artifact-name: TestLspd-LND-lspd_testOfflineNotificationRegularForward
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-LND-lspd_testOfflineNotificationZeroConfChannel:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/LND-lspd:_testOfflineNotificationZeroConfChannel"
          artifact-name: TestLspd-LND-lspd_testOfflineNotificationZeroConfChannel
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testOpenZeroConfChannelOnReceive:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testOpenZeroConfChannelOnReceive"
          artifact-name: TestLspd-CLN-lspd_testOpenZeroConfChannelOnReceive
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testOpenZeroConfSingleHtlc:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testOpenZeroConfSingleHtlc"
          artifact-name: TestLspd-CLN-lspd_testOpenZeroConfSingleHtlc
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testZeroReserve:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testZeroReserve"
          artifact-name: TestLspd-CLN-lspd_testZeroReserve
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testFailureBobOffline:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testFailureBobOffline"
          artifact-name: TestLspd-CLN-lspd_testFailureBobOffline
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testNoBalance:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testNoBalance"
          artifact-name: TestLspd-CLN-lspd_testNoBalance
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testRegularForward:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testRegularForward"
          artifact-name: TestLspd-CLN-lspd_testRegularForward
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testProbing:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testProbing"
          artifact-name: TestLspd-CLN-lspd_testProbing
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testInvalidCltv:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testInvalidCltv"
          artifact-name: TestLspd-CLN-lspd_testInvalidCltv
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_registerPaymentWithTag:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_registerPaymentWithTag"
          artifact-name: TestLspd-CLN-lspd_registerPaymentWithTag
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testOpenZeroConfUtxo:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testOpenZeroConfUtxo"
          artifact-name: TestLspd-CLN-lspd_testOpenZeroConfUtxo
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testDynamicFeeFlow:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testDynamicFeeFlow"
          artifact-name: TestLspd-CLN-lspd_testDynamicFeeFlow
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testOfflineNotificationPaymentRegistered:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testOfflineNotificationPaymentRegistered"
          artifact-name: TestLspd-CLN-lspd_testOfflineNotificationPaymentRegistered
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testOfflineNotificationRegularForward:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testOfflineNotificationRegularForward"
          artifact-name: TestLspd-CLN-lspd_testOfflineNotificationRegularForward
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}

  TestLspd-CLN-lspd_testOfflineNotificationZeroConfChannel:
    runs-on: ubuntu-20.04
    needs:
      - setup-bitcoin-core
      - setup-lnd-client
      - setup-lnd-lsp
      - setup-cln
      - build-lspd
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run and Process Test State
        uses: ./.github/actions/test-lspd
        with:
          TESTRE: "TestLspd/CLN-lspd:_testOfflineNotificationZeroConfChannel"
          artifact-name: TestLspd-CLN-lspd_testOfflineNotificationZeroConfChannel
          bitcoin-version: ${{ env.BITCOIN_VERSION }}
          LSP_REF: ${{ env.LSP_REF }}
          CLIENT_REF: ${{ env.CLIENT_REF }}
          GO_VERSION: ${{ env.GO_VERSION }}
          CLN_VERSION: ${{ env.CLN_VERSION }}
